<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ”¿åºœè¡Œæ”¿æ©Ÿé—œè¾¦å…¬æ—¥æ›†è¡¨æª¢è¦–å™¨</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; margin: 20px; background-color: #f4f4f9; }
        h1 { color: #333; }
        .controls { margin-bottom: 20px; }
        select { padding: 10px; font-size: 16px; cursor: pointer; }
        table { width: 100%; border-collapse: collapse; background: #fff; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        th, td { padding: 12px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background-color: #007bff; color: white; }
        tr:hover { background-color: #f1f1f1; }
        .holiday-yes { color: #d9534f; font-weight: bold; }
        .loading { color: #666; font-style: italic; }
        .meta-info { margin-left: 10px; color: #555; font-size: 0.9em; }
    </style>
</head>
<body>

    <h1>ğŸ“… è¡Œæ”¿æ©Ÿé—œè¾¦å…¬æ—¥æ›†è¡¨</h1>

    <div class="controls">
        <label for="yearSelect">é¸æ“‡å¹´ä»½ï¼š</label>
        <select id="yearSelect" onchange="loadData()">
            <option value="" disabled selected>è¼‰å…¥ä¸­...</option>
        </select>
        <span id="status" class="meta-info"></span>
    </div>

    <table id="dataTable">
        <thead>
            <tr>
                <th>æ—¥æœŸ</th>
                <th>åç¨±</th>
                <th>æ˜¯å¦æ”¾å‡</th>
                <th>é¡åˆ¥</th>
                <th>èªªæ˜</th>
            </tr>
        </thead>
        <tbody>
            <!-- Data rows will be inserted here -->
        </tbody>
    </table>

    <script>
        const yearSelect = document.getElementById('yearSelect');
        const dataTableBody = document.querySelector('#dataTable tbody');
        const statusDiv = document.getElementById('status');
        
        // Base path for data
        const DATA_BASE_PATH = 'opendata/holiday';

        async function init() {
            statusDiv.textContent = 'æ­£åœ¨è®€å–å¹´ä»½åˆ—è¡¨...';
            try {
                // Fetch the list of available years generated by the backend
                const response = await fetch(`${DATA_BASE_PATH}/years.json`);
                if (!response.ok) throw new Error("ç„¡æ³•è®€å–å¹´ä»½åˆ—è¡¨ (years.json)");
                
                const years = await response.json();
                
                yearSelect.innerHTML = ''; // Clear loading option

                if (years.length === 0) {
                    const option = document.createElement('option');
                    option.text = "ç„¡è³‡æ–™";
                    yearSelect.add(option);
                    return;
                }

                // Populate dropdown
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    yearSelect.appendChild(option);
                });

                // Auto-select the first year (assuming sorted descending: newest first)
                yearSelect.selectedIndex = 0;
                
                // Load data for the selected year
                loadData();

            } catch (error) {
                console.error('Init Error:', error);
                yearSelect.innerHTML = '<option>è¼‰å…¥å¤±æ•—</option>';
                statusDiv.textContent = 'åˆå§‹åŒ–å¤±æ•—ï¼Œè«‹ç¢ºèªå¾Œç«¯æ˜¯å¦å·²åŸ·è¡Œä¸¦ç”¢å‡º years.jsonã€‚';
            }
        }

        async function loadData() {
            const year = yearSelect.value;
            if (!year) return;

            const url = `${DATA_BASE_PATH}/${year}.json`;
            
            statusDiv.textContent = `æ­£åœ¨è®€å– ${year} å¹´è³‡æ–™...`;
            dataTableBody.innerHTML = '<tr><td colspan="5" class="loading">è¼‰å…¥è³‡æ–™ä¸­...</td></tr>';

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`ç„¡æ³•è®€å–è³‡æ–™ (HTTP ${response.status})`);
                }
                const data = await response.json();
                
                renderTable(data);
                statusDiv.textContent = `é¡¯ç¤º ${year} å¹´è³‡æ–™ï¼Œå…± ${data.length} ç­†ã€‚`;
            } catch (error) {
                console.error('Load Error:', error);
                statusDiv.textContent = `è®€å– ${year} å¤±æ•—ï¼š${error.message}`;
                dataTableBody.innerHTML = '<tr><td colspan="5">è®€å–å¤±æ•—</td></tr>';
            }
        }

        function renderTable(data) {
            if (data.length === 0) {
                dataTableBody.innerHTML = '<tr><td colspan="5">è©²å¹´åº¦ç„¡è³‡æ–™</td></tr>';
                return;
            }

            const rows = data.map(item => `
                <tr>
                    <td>${formatDate(item.date)}</td>
                    <td>${item.name}</td>
                    <td class="${item.holiday ? 'holiday-yes' : ''}">${item.holiday ? 'æ˜¯' : 'å¦'}</td>
                    <td>${item.holidayCategory}</td>
                    <td>${item.description}</td>
                </tr>
            `).join('');
            
            dataTableBody.innerHTML = rows;
        }

        function formatDate(dateStr) {
            // Simple formatting for YYYYMMDD -> YYYY/MM/DD
            if (dateStr && dateStr.length === 8) {
                return `${dateStr.substring(0, 4)}/${dateStr.substring(4, 6)}/${dateStr.substring(6, 8)}`;
            }
            return dateStr;
        }

        // Start the application
        init();
    </script>

</body>
</html>